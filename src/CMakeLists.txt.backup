# Source files
set(SOURCES
    main.cpp
    player.cpp
    add_music_single.cpp
    add_full_dir.cpp
    addgenre.cpp
    addjingle.cpp
    add_pub.cpp
    optionsdialog.cpp
    aboutus.cpp
    add_program.cpp
    audioinput.cpp
    config.cpp
    externaldownloader.cpp
    commonFunctions.cpp
    # Service layer
    services/IService.cpp
    services/ServiceContainer.cpp
    services/BaseService.cpp
    services/DatabaseService.cpp
    services/AudioService.cpp
    services/ConfigurationService.cpp
    services/ErrorHandler.cpp
    services/Logger.cpp
    services/InputValidator.cpp
    services/DatabaseOptimizer.cpp
    services/MusicCache.cpp
    services/AccessibilityManager.cpp
    services/AccessibilitySettingsService.cpp
    services/BrailleDisplayService.cpp
    services/WidgetAccessibilityEnhancer.cpp
    services/AccessibleTableInterface.cpp
    services/AccessibleTableEditingEnhancer.cpp
    services/AccessiblePlaylistInterface.cpp
    services/AccessibilityValidator.cpp
    services/KeyboardNavigationController.cpp
    services/PlayerKeyboardNavigationEnhancer.cpp
    services/DatabaseGridKeyboardNavigationEnhancer.cpp
    services/AudioFeedbackService.cpp
    services/PlayerAudioFeedbackIntegration.cpp
    services/BackgroundOperationFeedback.cpp
    services/LiveRegionManager.cpp
    services/PlaybackStatusAnnouncer.cpp
    services/SystemStatusAnnouncer.cpp
    services/AccessibilityPerformanceMonitor.cpp
    services/AccessibilityMemoryOptimizer.cpp
    services/AccessibilityErrorHandler.cpp
    services/ATSPIConnectionManager.cpp
    services/AccessibleHelpSystem.cpp
    services/ContextSensitiveHelpService.cpp
    # Controller layer
    controllers/MainController.cpp
    controllers/PlayerUIController.cpp
    # UI Components
    ui/ProgressIndicatorWidget.cpp
    # Models
    models/MusicListModel.cpp
    # Enhanced Dialogs
    dialogs/EnhancedAddMusicSingleDialog.cpp
    dialogs/EnhancedAddDirectoryDialog.cpp
    dialogs/AccessibilityPreferencesDialog.cpp
    # Repository layer
    repositories/MusicRepository.cpp
    repositories/GenreRepository.cpp
    repositories/PlaylistRepository.cpp
    repositories/DatabaseMigrator.cpp
)

# Header files
set(HEADERS
    player.h
    add_music_single.h
    add_full_dir.h
    addgenre.h
    addjingle.h
    add_pub.h
    optionsdialog.h
    aboutus.h
    add_program.h
    audioinput.h
    config.h
    externaldownloader.h
    commonFunctions.h
    # Service layer
    services/IService.h
    services/ServiceContainer.h
    services/BaseService.h
    services/DatabaseService.h
    services/AudioService.h
    services/ConfigurationService.h
    services/ErrorHandler.h
    services/Logger.h
    services/InputValidator.h
    services/DatabaseOptimizer.h
    services/MusicCache.h
    services/AccessibilityManager.h
    services/AccessibilitySettingsService.h
    services/BrailleDisplayService.h
    services/WidgetAccessibilityEnhancer.h
    services/KeyboardNavigationController.h
    services/PlayerKeyboardNavigationEnhancer.h
    services/DatabaseGridKeyboardNavigationEnhancer.h
    services/AudioFeedbackService.h
    services/PlayerAudioFeedbackIntegration.h
    services/BackgroundOperationFeedback.h
    services/LiveRegionManager.h
    services/PlaybackStatusAnnouncer.h
    services/SystemStatusAnnouncer.h
    services/AccessibilityPerformanceMonitor.h
    services/AccessibilityMemoryOptimizer.h
    services/AccessibilityErrorHandler.h
    services/ATSPIConnectionManager.h
    services/AccessibleHelpSystem.h
    services/ContextSensitiveHelpService.h
    # Controller layer
    controllers/MainController.h
    controllers/PlayerUIController.h
    controllers/ModernSignalConnections.h
    # UI Components
    ui/ProgressIndicatorWidget.h
    # Models
    models/MusicListModel.h
    # Enhanced Dialogs
    dialogs/EnhancedAddMusicSingleDialog.h
    dialogs/EnhancedAddDirectoryDialog.h
    dialogs/AccessibilityPreferencesDialog.h
    # Repository layer
    repositories/MusicRepository.h
    repositories/GenreRepository.h
    repositories/PlaylistRepository.h
    repositories/DatabaseMigrator.h
)

# UI files
set(UI_FILES
    player.ui
    add_music_single.ui
    add_full_dir.ui
    addgenre.ui
    addjingle.ui
    add_pub.ui
    optionsdialog.ui
    aboutus.ui
    add_program.ui
    externaldownloader.ui
    dialogs/AccessibilityPreferencesDialog.ui
)

# Resource files
set(RESOURCE_FILES
    tr.qrc
    resources.qrc
)

# Platform-specific sources
if(APPLE)
    list(APPEND SOURCES permission_utils.mm)
    list(APPEND HEADERS permission_utils.h)
endif()

# Create the executable
add_executable(XFB ${SOURCES} ${HEADERS} ${UI_FILES} ${RESOURCE_FILES})

# Link Qt6 libraries
target_link_libraries(XFB
    Qt6::Core
    Qt6::Gui
    Qt6::Widgets
    Qt6::Concurrent
    Qt6::Multimedia
    Qt6::Sql
    Qt6::Network
    Qt6::WebEngineCore
    Qt6::WebEngineQuick
    Qt6::QuickWidgets
)

# Platform-specific linking
if(APPLE)
    target_link_libraries(XFB ${AVFOUNDATION_FRAMEWORK})
    
    # Set app bundle properties
    set_target_properties(XFB PROPERTIES
        MACOSX_BUNDLE TRUE
        MACOSX_BUNDLE_INFO_PLIST "${CMAKE_CURRENT_SOURCE_DIR}/XFB.app/Contents/Info.plist"
        MACOSX_BUNDLE_ICON_FILE "XFB.icns"
        MACOSX_BUNDLE_GUI_IDENTIFIER "pt.netpack.xfb"
        MACOSX_BUNDLE_BUNDLE_NAME "XFB"
        MACOSX_BUNDLE_DISPLAY_NAME "XFB Radio Automation"
        MACOSX_BUNDLE_BUNDLE_VERSION ${PROJECT_VERSION}
        MACOSX_BUNDLE_SHORT_VERSION_STRING ${PROJECT_VERSION}
    )
    
    # Copy icon to bundle
    set(ICON_FILE "${CMAKE_SOURCE_DIR}/XFB.icns")
    set_source_files_properties(${ICON_FILE} PROPERTIES
        MACOSX_PACKAGE_LOCATION "Resources"
    )
    target_sources(XFB PRIVATE ${ICON_FILE})
endif()

if(UNIX AND NOT APPLE)
    # Set RPATH for Linux
    set_target_properties(XFB PROPERTIES
        INSTALL_RPATH "$ORIGIN"
        BUILD_WITH_INSTALL_RPATH TRUE
    )
endif()

# Install targets
install(TARGETS XFB
    BUNDLE DESTINATION .
    RUNTIME DESTINATION bin
)

# Install additional files
if(UNIX AND NOT APPLE)
    install(FILES "${CMAKE_SOURCE_DIR}/XFB.desktop"
        DESTINATION share/applications
    )
    install(FILES "${CMAKE_SOURCE_DIR}/xfb_icon.png"
        DESTINATION share/pixmaps
        RENAME xfb.png
    )
endif()